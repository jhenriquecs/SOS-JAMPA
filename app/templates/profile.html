{% extends 'base.html' %} {% block content %}
{% set is_owner = is_owner if is_owner is defined else True %}
<div class="profile-container">
  <!-- Cover Section -->
  <div class="profile-cover">
    <!-- Placeholder for cover image, or use a gradient defined in CSS -->
    <img
      src="{{ url_for('static', filename=user.cover_image.replace('\\', '/')) if user.cover_image else 'https://picsum.photos/seed/' + user.id + '/940/350' }}"
      alt="Cover"
      class="profile-cover-img"
      onerror="this.src='https://picsum.photos/seed/{{ user.id }}/940/350'"
    />

    <div class="profile-header-info">
      <div class="profile-pic-container">
        <img
          src="{{ url_for('static', filename=user.profile_image.replace('\\', '/')) if user.profile_image else 'https://ui-avatars.com/api/?name=' + (user.nickname|urlencode) + '&background=random&size=168' }}"
          onerror="this.src='https://ui-avatars.com/api/?name={{ user.nickname|urlencode }}&background=random&size=168'"
          alt="Profile"
          class="profile-pic-large"
        />
        {% if is_owner %}
        <button class="profile-pic-edit-btn" onclick="openEditModal()">
          <i class="fas fa-camera"></i>
        </button>
        {% endif %}
      </div>

      <div class="profile-names">
        <h1 class="profile-name-main">{{ user.nome or user.nickname }}</h1>
        <h2 class="profile-nickname">@{{ user.nickname }}</h2>
      </div>

      {% if is_owner %}
      <div class="profile-actions">
        <button class="btn-edit-profile" onclick="openEditModal()">
          <i class="fas fa-pen"></i> Editar perfil
        </button>
      </div>
      {% endif %}
    </div>
  </div>

  <!-- Profile Menu -->
  <div class="profile-menu-bar">
    <a href="#" class="profile-menu-item active">Posts</a>
    <a href="#" class="profile-menu-item">Sobre</a>
    <a href="#" class="profile-menu-item">Seguindo</a>
    <a href="#" class="profile-menu-item">Seguidores</a>
  </div>

  <!-- Main Content Grid -->
  <div class="profile-content-grid">
    <!-- Left Sidebar -->
    <div class="profile-sidebar">
      <div class="profile-card">
        <div class="card-header">
          <h3 class="card-title">Intro</h3>
        </div>
        <div class="intro-item">
          <span class="intro-icon"><i class="fas fa-envelope"></i></span>
          <span>{{ user.email }}</span>
        </div>
        <div class="intro-item">
          <span class="intro-icon"><i class="fas fa-clock"></i></span>
          <span>Entrou em {{ joined_date or 'N/A' }}</span>
        </div>
        {% if user.is_admin %}
        <div class="intro-item">
          <span class="intro-icon"><i class="fas fa-shield-alt"></i></span>
          <span>Administrador</span>
        </div>
        {% endif %} {% if user.is_dev %}
        <div class="intro-item">
          <span class="intro-icon"><i class="fas fa-code"></i></span>
          <span>Desenvolvedor</span>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Main Feed -->
    <div class="profile-feed">
      <!-- User Posts -->
      {% for p in posts %} {% include 'components/post_card.html' %} {% else %}
      <div class="profile-card profile-empty-state">
        <h3>Nenhuma publicação ainda</h3>
        <p>Compartilhe sua primeira denúncia ou ideia!</p>
      </div>
      {% endfor %}
    </div>
  </div>
</div>

{% if is_owner %}
<!-- Edit Profile Modal -->
<div id="editProfileModal" class="profile-modal-overlay">
  <div class="profile-modal-card">
    <button class="close-modal-btn" onclick="closeEditModal()">&times;</button>
    <h3 class="modal-title">Editar Perfil</h3>

    <form
      id="editProfileForm"
      method="post"
      enctype="multipart/form-data"
      class="modal-form"
    >
      <div class="profile-form-group">
        <label class="profile-form-label">Foto de Perfil</label>

        <!-- Upload Area -->
        <div id="imageUploadArea" class="upload-area">
          <img
            src="{{ url_for('static', filename=user.profile_image.replace('\\', '/')) if user.profile_image else 'https://ui-avatars.com/api/?name=' + (user.nickname|urlencode) + '&background=random' }}"
            onerror="this.src='https://ui-avatars.com/api/?name={{ user.nickname|urlencode }}&background=random'"
            class="preview-img"
          />
          <input
            type="file"
            id="profileImageInput"
            name="profile_image"
            accept="image/*"
          />
        </div>

        <!-- Cropper Area -->
        <div id="cropperArea" class="profile-cropper-area">
          <div class="cropper-wrapper">
            <img id="imageToCrop" class="image-to-crop" />
          </div>
          <button type="button" id="btnCropCancel" class="btn-cancel-crop">
            Cancelar Recorte
          </button>
        </div>
      </div>

      <div class="profile-form-group">
        <label class="profile-form-label">Foto de Capa</label>
        <input type="file" name="cover_image" accept="image/*" />
      </div>

      <div class="profile-form-group">
        <label class="profile-form-label">Nome Completo</label>
        <input
          type="text"
          name="nome"
          value="{{ user.nome or '' }}"
          class="input-nickname"
        />
      </div>

      <div class="profile-form-group">
        <label class="profile-form-label">Nickname</label>
        <input
          type="text"
          name="nickname"
          value="{{ user.nickname }}"
          class="input-nickname"
        />
      </div>

      <div class="modal-actions">
        <button
          type="button"
          onclick="closeEditModal()"
          class="btn-modal-cancel"
        >
          Cancelar
        </button>
        <button type="submit" class="btn-modal-save">Salvar</button>
      </div>
    </form>
  </div>
</div>
{% endif %}

<!-- Cropper.js -->
{% if is_owner %}
<link
  href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css"
  rel="stylesheet"
/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

<script src="{{ url_for('static', filename='js/profile.js') }}"></script>
{% endif %}

<!-- FontAwesome for icons -->
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
/>

{% endblock %}
